BeatsChain consolidated context — 2025-11-11

Summary
-------
This file summarizes the current repo status and next recommended steps after a quick inventory and inspection on 2025-11-11.

High-level findings
-------------------
- Repo is a monorepo with root `package.json` and `packages/app` (Next.js frontend) using wagmi/ethers/viem, Sanity, Firebase. Next.js version is ^15.
- A Chrome extension package is present as `BeatsChain-Migration-Pack (1).zip`. The ZIP contains a full extension build with `lib/thirdweb.js`, `lib/ipfs.js`, `lib/unified-auth.js`, `server/` (ipfsPinner, tokenExchange), and many helper libs (samro-pdf-manager.js, samro-split-manager.js, solana-wallet.js, etc.). The extension uses Thirdweb and its own IPFS integrations.
- The main frontend (`packages/app`) does not currently include Thirdweb — it uses wagmi/ethers/viem for web3 interactions.
- IPFS/Pinata references and gateway configuration are present across docs and env examples (NEXT_PUBLIC_IPFS_GATEWAY set to Pinata gateway in docs).
- A small backend/service in the extension ZIP (`server/tokenExchange.js`, `server/ipfsPinner.js`, `server/routes/ipfs-proxy.js`) provides token exchange and IPFS pinner features; this is a strong candidate for an MCP (microservice) server.

Immediate technical conflicts
-----------------------------
- Two different web3 stacks exist: extension → Thirdweb (embedded gasless flows) and app → wagmi/ethers (user-signed flows). We must pick an integration strategy that avoids breaking existing production flows.
- Auth systems overlap: `firebase` / `unified-auth` logic in the extension ZIP vs `siwe` + `wagmi`/ethers in the app. We need a token-exchange or adapter layer to bridge Google/Firebase ID tokens and wallet sessions.

Non-breaking approach (summary)
-------------------------------
- Keep both stacks during migration. Introduce an MCP server (packages/mcp-server) by extracting `server/tokenExchange.js` & `server/ipfsPinner.js` from the extension ZIP. MCP server handles:
  - Firebase ID token <-> internal session JWT exchange
  - IPFS pinning proxy (Pinata/Gateway)
  - Optional minting relay endpoints (gasless mint via Thirdweb or relay to Solana)
- Add a `packages/shared` workspace containing small adapters:
  - `shared/auth` (token helpers, id token verification)
  - `shared/ipfs` (pin, gateway helpers)
  - `shared/livepeer` (upload helper wrapper)
  - `shared/thirdweb-adapter` (only if you accept Thirdweb for PWA flows)
- Implement an opt-in Thirdweb adapter in PWA — keep default PWA mint path using existing wagmi/ethers flows. Use the MCP server to offer gasless minting via Thirdweb only when requested.

Files/Modules to extract or refactor (candidates)
--------------------------------------------------
- From extension ZIP:
  - `lib/thirdweb.js` -> `packages/shared/thirdweb-adapter`
  - `lib/ipfs.js` and `lib/ipfs-asset-manager.js` -> `packages/shared/ipfs`
  - `server/ipfsPinner.js`, `server/tokenExchange.js`, `server/routes/ipfs-proxy.js` -> `packages/mcp-server`
  - `lib/unified-auth.js`, `lib/enhanced-auth.js`, `lib/backend-auth.js` -> `packages/shared/auth`
  - `lib/samro-pdf-manager.js`, `lib/samro-split-manager.js` -> `packages/app/src/lib/samro` or `packages/shared/pdf`
- From `packages/app`: create a `packages/shared/web3-adapter` which normalizes onchain responses, IPFS CIDs, and metadata shapes.

Chrome Web Store compliance notes
---------------------------------
- Keep `privacy-policy.md` visible at `/privacy-policy` hosted by the PWA. Chrome Store requires a live URL; deploy PWA first then set that URL in Store listing.
- Manifest V3: avoid permissions beyond minimal (storage, identity if used, activeTab). Do not use persistent background pages; use service worker (manifest v3 compliant). `BeatsChain-Migration-Pack` already contains `background/service-worker.js` and `manifest.json` — review for wide permissions and remove anything unnecessary.
- Do not transmit user secrets in extension; use MCP server for any privileged API keys.

Environment and secrets
-----------------------
Recommended env variables (examples):
- FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID
- LIVEPEER_API_KEY
- PINATA_API_KEY, PINATA_SECRET
- THIRDWEB_API_KEY (if using Thirdweb server-side)
- MCP_JWT_SECRET
- NEXT_PUBLIC_IPFS_GATEWAY (frontend readable)

Next steps (operational)
------------------------
1. Extract server code from ZIP into `packages/mcp-server` and run locally (provides token exchange + ipfs pinner).
2. Create `packages/shared` adapters and import into both extension and `packages/app` where needed.
3. Add a `CONTEXT_2025-11-11.md` (this file) and a short `DEVS_README.md` with minimal dev rules (manifest/permissions, env var names, deploy targets).

Notes
-----
- This repo contains many overlapping docs. A single dated context file (this file) will help centralize decisions going forward.
- I did not change code; this file is only a summarizing artifact created 2025-11-11.

Signed-off-by: Copilot agent (analysis)
